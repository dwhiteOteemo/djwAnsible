---
- hosts: localhost
  vars:
    description: “Provision a VM from a template”
    vc_hostname: vcenterhostname
    vc_username: vcenterusername
    vc_passwd: vcenterpassword
    dcenter: datacentername
    vm_name: vmname
    vm_folder: /DCA/vm/Templates
    vm_datastore: ExternalDS-13
    vm_nodename: 172.16.5.13
    vm_template: cfme-vsphere-5.8.1.5-1.x86_64.vsphere
  tasks:
    - name: create the VM
      vmware_guest:
        validate_certs: False
        hostname: "{{ vc_hostname }}"
        username: "{{ vc_username }}"
        password: "{{ vc_passwd }}"
        name: "{{ vm_name }}"
        state: poweredon
        folder: "{{ vm_folder }}"
        disk:
            - size_gb: 10
              type: thin
              datastore: "{{ vm_datastore }}"
        nic:
            - type: vmxnet3
              network: VM Network
              network_type: standard
        hardware:
            memory_mb: 512
            num_cpus: 1
            osid: centos64guest
            scsi: paravirtual
        datacenter: "{{ dcenter }}"
        esxi_hostname: "{{ vm_nodename }}"
        template: "{{ vm_template }}"
        wait_for_ip_address: yes
      register: deploy

